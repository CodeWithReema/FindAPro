{% extends 'providers/profile/create_base.html' %}

{% block step_content %}
<div class="mb-6">
    <h3 class="text-xl font-display font-bold text-gray-900 mb-2">Availability & Emergency</h3>
    <p class="text-gray-600">Set your availability preferences</p>
</div>

{% if completion_percentage < 50 %}
<div class="p-4 bg-yellow-50 border border-yellow-200 rounded-xl mb-6">
    <p class="text-sm text-yellow-800">
        <strong>Profile Incomplete:</strong> Your profile is only {{ completion_percentage }}% complete. 
        Please complete at least 50% to submit for review.
    </p>
</div>
{% endif %}

<form method="POST" id="profile-form" class="space-y-6">
    {% csrf_token %}
    
    <div class="space-y-4">
        <label class="flex items-start gap-3">
            {{ form.is_available_now }}
            <div>
                <span class="block text-sm font-medium text-gray-700">Currently Available</span>
                <span class="text-xs text-gray-500">Check this if you're available to take on new jobs right now</span>
            </div>
        </label>
        
        <label class="flex items-start gap-3">
            {{ form.accepts_emergency }}
            <div>
                <span class="block text-sm font-medium text-gray-700">Accept Emergency Requests</span>
                <span class="text-xs text-gray-500">Check this if you're willing to handle urgent/emergency requests</span>
            </div>
        </label>
    </div>
    
    <div id="emergency-rate" style="display: none;">
        <label for="{{ form.emergency_rate_info.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
            Emergency Rate Information
        </label>
        {{ form.emergency_rate_info }}
        {% if form.emergency_rate_info.errors %}
        <p class="mt-1 text-sm text-red-600">{{ form.emergency_rate_info.errors.0 }}</p>
        {% endif %}
        <p class="mt-1 text-xs text-gray-500">e.g., "25% premium for emergencies" or "Standard rate + $50 rush fee"</p>
    </div>
    
    <div class="p-4 bg-green-50 border border-green-200 rounded-xl">
        <p class="text-sm text-green-800">
            <strong>Almost Done!</strong> Once you submit, you'll receive an email to verify your address. 
            After verification, your profile will be automatically approved and go live.
        </p>
    </div>
</form>

<script>
document.getElementById('id_accepts_emergency').addEventListener('change', function() {
    const emergencyRate = document.getElementById('emergency-rate');
    if (this.checked) {
        emergencyRate.style.display = 'block';
    } else {
        emergencyRate.style.display = 'none';
    }
});
</script>
{% endblock %}

{% block next_button %}
{% if completion_percentage >= 50 %}
<button type="submit" form="profile-form" class="btn-primary">
    Continue to Preview
</button>
{% else %}
<button type="button" class="btn-secondary opacity-50 cursor-not-allowed" disabled>
    Complete 50% to Continue
</button>
{% endif %}
{% endblock %}
